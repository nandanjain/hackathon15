<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0"/>
    <title></title>
    <style type="text/css">
        body {
            font-family: monospace;
            font-size: 1.8rem;
        }

        /* Login Page */
        #main {
            text-align: center;
        }

        span.error_message {
            color: red
        }

        h1 {
            font-size: 5rem;
            text-shadow: 0.3rem 0.3rem rgba(200, 200, 200, .5);
        }

        h2 {
            text-align: center;
            border-radius: 10px 10px 0 0;
            margin: -10px -40px;
            padding: 15px
        }

        #login {
            width: 300px;
            border-radius: 10px;
            border: 2px solid #ccc;
            padding: 1rem 2rem;
            margin: auto;
            background-color: rgba(77, 77, 77, 0.7);
        }

        input {
            font-size: 1rem;
            padding: 0.5rem 0 0.5rem 0;
            margin: 1rem 0;
        }

        input[type=text], input[type=password] {
            width: 99.5%;
            background-color: rgba(255, 255, 255, 0.6);
        }

        input[type=text]:focus, input[type=password]:focus,
        input[type=text]:hover, input[type=password]:hover {
            background-color: rgba(255, 255, 255, 1);
        }

        input[type=submit] {
            width: 100%;
            color: #fff;
            padding: 10px;
            cursor: pointer;
            border-radius: 5px;
            margin-bottom: 15px;
            background: rgba(77, 77, 77, 0.5);
        }

        input[type=submit]:hover {
            background: rgba(0, 0, 0, 0.5);
        }

        input::-webkit-input-placeholder {
            color: rgba(0, 0, 0, 0.6);
        }

        /* Old Firefox below 18 */
        input:-moz-placeholder {
            color: rgba(0, 0, 0, 0.6);
        }

        /* New Firefox */
        input::-moz-placeholder {
            color: rgba(0, 0, 0, 0.6);
        }

        div#accessRequest {
            position: absolute;
            top: 10%;
            left: 10%;
            height: 60%;
            width: 70%;
            border: 2rem solid red;
            display: none;
        }

        img {
            position: relative;
            top: 0;
            /* border: 1px solid red; */
            left: 50%;
            height: 100%;
            width: 50%;
            background-color: black;
        }

        button {
            position: absolute;
            left: 0;
            height: 50%;
            width: 50%;
            font-size: 2rem;
            font-weight: bold;
        }

        button#button_accept {
            top: 0%;
            color: darkgreen;
        }

        button#button_reject {
            top: 50%;
            color: red;
        }
    </style>

</head>
<body>
<div id="login">
    <h2>Login</h2>
    <label>EMail :</label>
    <input id="email" name="email" placeholder="email@server.com" type="text">
    <label>Password :</label>
    <input id="password" name="password" placeholder="**********" type="password">
    <input name="submit" type="button" value=" Login " onclick="loginSubmit()">
    <span id="error_message"></span>
</div>
<div id="logPage">
    Checking if there is someone at door...
    You will be notified.
</div>
<div id="accessRequest">
    <img src="" id="stranger_img">
    <button id="button_accept" onclick="allow_access()">Allow</button>
    <button id="button_reject" onclick="deny_access()">Deny</button>
</div>

<script type="text/javascript">
    var logPage = document.getElementById("logPage");
    var loginPage = document.getElementById("login");
    var accessRequest = document.getElementById("accessRequest");
    function allow_access() {
        var httpReq = new XMLHttpRequest();
        httpReq.open("POST", "server.php", true);
        httpReq.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        httpReq.send("authorizeOpen=true&" + new Date().getTime());
        accessRequest.style.display = "none";
        setTimeout(showLogPage, 12000);
    }
    function deny_access() {
        var httpReq = new XMLHttpRequest();
        httpReq.open("POST", "server.php", true);
        httpReq.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        httpReq.send("rejectAccess=true&" + new Date().getTime());
        accessRequest.style.display = "none";
        setTimeout(showLogPage, 12000);
    }
    function loginSubmit() {
        var username = document.getElementById("email").value;
        var password = document.getElementById("password").value;
        alert(username + " : " + password);

        var httpReq = new XMLHttpRequest();
        httpReq.open("POST", "server.php", true);
        httpReq.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        httpReq.onreadystatechange = loginResponse;
        httpReq.send("adminLogin=jd&username=" + username + "&password=" + password + "&" + new Date().getTime());
    }
    function loginResponse() {
        if (this.readyState == 4 && this.status == 200) {
            switch (this.responseText) {
                case 'login:success' :
                    auth_success();
                    break;
                case 'login:failure' :
                    auth_denied();
                    break;
            }
        }
    }
    function auth_success() {
        loginPage.style.display = "none";
        showLogPage();
    }
    function auth_denied() {
        alert("User Name or password is incorrect");
    }
    function showLogPage() {
        logPage.style.display = "block";
        pollRequest();
    }
    function pollRequest() {
        var httpReq = new XMLHttpRequest();
        httpReq.open("GET", "stranger/image.png?" + new Date().getTime(), true);
        httpReq.onreadystatechange = pollResponse;
        httpReq.send(null);
    }
    function pollResponse() {
        if (this.readyState == 4) {
            if (this.status == 200) {
                alert("SomeOne is ur door !!!");
                requestAccess();
            } else {
                setTimeout(pollRequest, 5000);
            }
        }
    }
    function requestAccess() {
        var image = document.getElementById("stranger_img");
        accessRequest.style.display = "block";
        image.src = "stranger/image.png?" + new Date().getTime();
    }
</script>
</body>
</html>